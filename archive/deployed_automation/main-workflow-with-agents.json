{
  "name": "CV Processing with Dual Agents",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "minutes",
              "minutesInterval": 30
            }
          ]
        }
      },
      "id": "schedule-trigger",
      "name": "Every 30 Minutes",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.1,
      "position": [250, 300]
    },
    {
      "parameters": {
        "operation": "list",
        "fileId": {
          "__rl": true,
          "value": "1dMuo2J3L52QqDmHj0UOEe9MSk0gsPSNa",
          "mode": "id"
        },
        "filter": {
          "__rl": true,
          "value": "='{{$parameter[\"fileId\"]}}' in parents and trashed = false and mimeType = 'application/pdf'",
          "mode": "id"
        },
        "returnAll": true
      },
      "id": "get-all-cvs",
      "name": "Get All New CVs",
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [450, 300]
    },
    {
      "parameters": {
        "batchSize": 5,
        "options": {}
      },
      "id": "split-batches",
      "name": "Split In Batches",
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [650, 300]
    },
    {
      "parameters": {
        "operation": "download",
        "fileId": {
          "__rl": true,
          "value": "={{ $json.id }}",
          "mode": "id"
        },
        "options": {
          "googleFileConversion": {
            "conversion": {
              "docsToFormat": "text/plain"
            }
          }
        }
      },
      "id": "download-cv",
      "name": "Download CV",
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [850, 300]
    },
    {
      "parameters": {
        "binaryPropertyName": "data",
        "options": {}
      },
      "id": "extract-text",
      "name": "Extract PDF Text",
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [1050, 300]
    },
    {
      "parameters": {
        "workflowId": "scoring-agent",
        "input": {
          "cv_text": "={{ $json.text }}",
          "position_context": "We are hiring for: Data Analyst, Backend Developer, DevOps Engineer, Product Manager",
          "file_info": {
            "id": "={{ $('download-cv').item.json.id }}",
            "name": "={{ $('download-cv').item.json.name }}"
          }
        }
      },
      "id": "call-scoring-agent",
      "name": "Call Scoring Agent",
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1,
      "position": [1250, 300]
    },
    {
      "parameters": {
        "mode": "raw",
        "jsonOutput": "={{ \nconst analysis = $json.analysis;\nconst processed = analysis && analysis.overall_score !== undefined;\n\n{\n  ...analysis,\n  '_processingSuccess': processed,\n  '_fileId': $('download-cv').item.json.id,\n  '_fileName': $('download-cv').item.json.name,\n  '_shouldResearch': processed && analysis.overall_score >= 85\n}\n}}",
        "options": {}
      },
      "id": "prepare-data",
      "name": "Prepare Data",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.2,
      "position": [1450, 300]
    },
    {
      "parameters": {
        "operation": "appendToRange",
        "documentId": {
          "__rl": true,
          "value": "1H0K91oMK2T5F6vEi9H4I9VxMx2_fqQ6ShGHxBnGxQQo",
          "mode": "id"
        },
        "sheetName": "Sheet1",
        "range": "A:J",
        "data": {
          "autoMapMode": "defineBelow",
          "value": {
            "Name": "={{ $json.name }}",
            "Email": "={{ $json.email }}",
            "Phone": "={{ $json.phone }}",
            "Overall Score": "={{ $json.overall_score }}",
            "Best Position": "={{ $json.best_position }}",
            "Technical Skills": "={{ $json.technical_skills }}",
            "Experience": "={{ $json.experience_summary }}",
            "Key Strengths": "={{ $json.key_strengths }}",
            "Processing Date": "={{ new Date().toISOString() }}",
            "Status": "={{ $json._processingSuccess ? 'Processed' : 'Failed' }}"
          }
        }
      },
      "id": "log-to-sheets",
      "name": "Log to Sheets",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.1,
      "position": [1650, 300]
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{ $json._shouldResearch }}",
              "value2": true
            }
          ]
        }
      },
      "id": "should-research",
      "name": "Score >= 85?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [1850, 300]
    },
    {
      "parameters": {
        "workflowId": "research-agent",
        "input": {
          "task": "research",
          "candidate": {
            "name": "={{ $json.name }}",
            "email": "={{ $json.email }}",
            "score": "={{ $json.overall_score }}",
            "position": "={{ $json.best_position }}",
            "skills": "={{ $json.technical_skills }}"
          }
        }
      },
      "id": "trigger-research",
      "name": "Trigger Research Agent",
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1,
      "position": [2050, 200],
      "continueOnFail": true
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{ $json._processingSuccess }}",
              "value2": true
            }
          ]
        }
      },
      "id": "check-success",
      "name": "Processing Success?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [2050, 400]
    },
    {
      "parameters": {
        "operation": "move",
        "fileId": {
          "__rl": true,
          "value": "={{ $json._fileId }}",
          "mode": "id"
        },
        "folderId": {
          "__rl": true,
          "value": "1CQWsocqKluQnSkUdMGQsL-Owsr7aQXQn",
          "mode": "id"
        }
      },
      "id": "move-processed",
      "name": "Move to Processed",
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [2250, 350]
    },
    {
      "parameters": {
        "operation": "move",
        "fileId": {
          "__rl": true,
          "value": "={{ $json._fileId }}",
          "mode": "id"
        },
        "folderId": {
          "__rl": true,
          "value": "1mu9rgElrKMU1vt22EC7KaKWquw1EkJDP",
          "mode": "id"
        }
      },
      "id": "move-failed",
      "name": "Move to Failed",
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [2250, 450]
    }
  ],
  "connections": {
    "schedule-trigger": {
      "main": [
        [
          {
            "node": "get-all-cvs",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "get-all-cvs": {
      "main": [
        [
          {
            "node": "split-batches",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "split-batches": {
      "main": [
        [
          {
            "node": "download-cv",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "download-cv": {
      "main": [
        [
          {
            "node": "extract-text",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "extract-text": {
      "main": [
        [
          {
            "node": "call-scoring-agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "call-scoring-agent": {
      "main": [
        [
          {
            "node": "prepare-data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "prepare-data": {
      "main": [
        [
          {
            "node": "log-to-sheets",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "log-to-sheets": {
      "main": [
        [
          {
            "node": "should-research",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "should-research": {
      "main": [
        [
          {
            "node": "trigger-research",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "check-success",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "trigger-research": {
      "main": [
        [
          {
            "node": "check-success",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "check-success": {
      "main": [
        [
          {
            "node": "move-processed",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "move-failed",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "move-processed": {
      "main": [
        [
          {
            "node": "split-batches",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  }
}