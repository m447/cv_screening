{
  "parameters": {
    "jsCode": "// Get the AI response from the agent output\nconst response = $input.item.json.response || $input.item.json.output || $input.item.json;\nlet aiText = '';\n\n// Extract text from the response structure\nif (response.generations && response.generations[0] && response.generations[0][0]) {\n  aiText = response.generations[0][0].text;\n} else if (typeof response === 'string') {\n  aiText = response;\n} else if (response.text) {\n  aiText = response.text;\n}\n\n// Remove markdown code blocks if present\naiText = aiText.replace(/```json\\n?/g, '').replace(/```\\n?/g, '').trim();\n\n// Get file info from Download CV node\nconst downloadData = $('Download CV').item.json;\nconst fileId = downloadData.id;\nconst fileName = downloadData.name;\n\n// Parse the JSON\ntry {\n  const jsonData = JSON.parse(aiText);\n  \n  // Format the Google Drive link\n  const driveLink = `https://drive.google.com/file/d/${fileId}/view?usp=drivesdk`;\n  \n  // Return formatted data for Google Sheets\n  return {\n    'Date Applied': new Date().toISOString().split('T')[0],\n    'Candidate Name': jsonData.name,\n    'CV Link': driveLink,\n    'Score': jsonData.overall_score,\n    'Category': jsonData.category,\n    'Matched Keywords': jsonData.matchedSkills.join(', '),\n    'Red Flags': jsonData.redFlags.length > 0 ? jsonData.redFlags.join(', ') : 'None',\n    'Status': 'AI Reviewed',\n    'AI Recommendation': jsonData.recommendation,\n    'Years Experience': jsonData.yearsExperience,\n    'Strengths': jsonData.strengths.join('; '),\n    '_processingSuccess': true,\n    '_fileId': fileId,\n    '_fileName': fileName\n  };\n} catch (error) {\n  // If parsing fails, return error info\n  const driveLink = `https://drive.google.com/file/d/${fileId}/view?usp=drivesdk`;\n  \n  return {\n    'Date Applied': new Date().toISOString().split('T')[0],\n    'Candidate Name': 'Parse Error',\n    'CV Link': driveLink,\n    'Score': 0,\n    'Category': 'Error',\n    'Matched Keywords': '',\n    'Red Flags': 'Failed to parse AI response',\n    'Status': 'Error - Review Needed',\n    'AI Recommendation': 'Manual review required',\n    'Years Experience': 'Unknown',\n    'Strengths': '',\n    '_processingSuccess': false,\n    '_fileId': fileId,\n    '_fileName': fileName,\n    '_error': error.message\n  };\n}"
  },
  "id": "e2aea1ec-0fd4-46be-8dd4-648b46e380b8",
  "name": "Parse AI Response",
  "type": "n8n-nodes-base.code",
  "typeVersion": 2,
  "position": [304, 96]
}